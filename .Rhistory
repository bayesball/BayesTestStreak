se = FALSE) +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0)) +
ggtitle("Comparing Home Run Rates") +
ylab("HR Rate (Pct)")
aaron_pujols %>%
group_by(Player, Age) %>%
summarize(AB = n(),
HR = sum(Outcome),
.groups = "drop") %>%
mutate(p = HR / AB,
M = 1 / p,
Var = (1 - p) / p ^ 2,
Measure = Var / M / (1 + M)) -> S1
library(purrr)
find_spacings2 <- function(age, streak_data) {
d <- filter(streak_data, Age = age)
runs <- rle(d$Outcome)
data.frame(Age = age,
Spacing =
runs$lengths[runs$values == 0])
}
find_spacings2(28, filter(aaron_pujols,
Player == "Albert Pujols" ))
find_spacings2 <- function(age, streak_data) {
d <- filter(streak_data, Age == age)
runs <- rle(d$Outcome)
data.frame(Age = age,
Spacing =
runs$lengths[runs$values == 0])
}
find_spacings2(28, filter(aaron_pujols,
Player == "Albert Pujols" ))
filter(filter(aaron_pujols,
Player == "Albert Pujols" )) %>%
summarize(Min = min(Age), Max = max(Age))
ap_spacings <- map_df(21:41, filter(aaron_pujols,
Player == "Albert Pujols" ))
ap_spacings <- map_df(21:41, find_spacings2,
filter(aaron_pujols,
Player == "Albert Pujols" ))
View(ap_spacings)
ap_spacings <- map_df(21:41, find_spacings2,
filter(aaron_pujols,
Player == "Albert Pujols" )) %>%
mutate(Player = "Albert Pujols")
filter(aaron_pujols,
Player == "Henry Aaron" ) %>%
summarize(Min = min(Age), Max = max(ages))
summarize(Min = min(Age), Max = max(Age))
filter(aaron_pujols,
Player == "Henry Aaron" ) %>%
summarize(Min = min(Age), Max = max(Age))
ha_spacings <- map_df(20:42, find_spacings2,
filter(aaron_pujols,
Player == "Henry Aaron" )) %>%
mutate(Player = "Henry Aaron")
all_spacings <- rbind(ha_spacings,
ap_spacings)
all_spacings %>%
group_by(Player, Age) %>%
summarize(M = mean(Spacing),
V = var(Spacings)) %>%
mutate(Measure = V / M / (M + 1)) -> S1
all_spacings %>%
group_by(Player, Age) %>%
summarize(M = mean(Spacing),
V = var(Spacing)) %>%
mutate(Measure = V / M / (M + 1)) -> S1
head(S1)
View(S1)
ggplot(S1, aes(Age, Measure, color = Player)) +
geom_point() +
geom_hline(yintercept = 1)
ggtitle("Comparing Streaky Measures")
ggplot(S1, aes(Age, Measure, color = Player)) +
geom_point() +
geom_hline(yintercept = 1) +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5)) +                               vjust = 0.8, angle = 0)) +
theme(text=element_text(size=18),
ggplot(S1, aes(Age, Measure, color = Player)) +
geom_point() +
geom_hline(yintercept = 1) +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0)) +
ggtitle("Comparing Streaky Measures")
head(all_spacings)
ggplot(all_spacings,
aes(Spacings, Player)) +
geom_jitter()
ggplot(all_spacings,
aes(Spacing, Player)) +
geom_jitter()
ggplot(all_spacings,
aes(log(Spacing), Player)) +
geom_jitter()
ggplot(all_spacings,
aes(Spacing, Player)) +
geom_jitter() +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0)) +
ggtitle("Comparing Lengths of Spacings")
q1 <- quantile(filter(all_spacings,
Player == "Henry Aaron")$Spacing,
c(.25, .5, .75))
q
filter(all_spacings,
Player == "Henry Aaron")$Spacing
quantile(rnorm(100), c(.25, .75))
ha_values <- filter(all_spacings,
Player == "Henry Aaron")$Spacing
q1 <- quantile(ha_values,
c(.25, .5, .75))
q1
q1 <- quantile(ha_values,
seq(.05, .95, by = .1))
q1
ap_values <- filter(all_spacings,
Player == "Albert Pujols")$Spacing
q1 <- quantile(ap_values,
seq(.05, .95, by = .1))
q2 <- quantile(ap_values,
seq(.05, .95, by = .1))
q2
q1 <- quantile(ha_values,
seq(.05, .95, by = .1))
ap_values <- filter(all_spacings,
Player == "Albert Pujols")$Spacing
q2 <- quantile(ap_values,
seq(.05, .95, by = .1))
plot(q1, q2)
abline()
abline(intercept = 0, slope = 1)
?abline
plot(q1, q2)
abline(a = 0, b = 1)
q1
q2
geometric_plot(aaron_spacings)
geometric_plot(pujols_spacings)
aaron_pujols %>%
group_by(Player) %>%
summarize(AB = n(),
HR = sum(Outcome)) %>%
mutate(HR_Rate = 100 * HR / AB)
library(BayesTestStreak)
library(readr)
library(dplyr)
library(ggplot2)
library(purrr)
aaron_pujols <-
read_csv("aaron_pujols_HR.csv")
aaron_pujols %>%
group_by(Player) %>%
summarize(AB = n(),
HR = sum(Outcome)) %>%
mutate(HR_Rate = 100 * HR / AB)
aaron_spacings <- find_spacings(filter(aaron_pujols,
Player == "Henry Aaron"))
geometric_plot(aaron_spacings)
pujols_spacings <- find_spacings(filter(aaron_pujols,
Player == "Albert Pujols"))
geometric_plot(pujols_spacings)
ages <- data.frame(Player = c("Henry Aaron",
"Albert Pujols"),
Birthyear = c(1934, 1980))
inner_join(aaron_pujols, ages, by = "Player") ->
aaron_pujols
aaron_pujols %>%
mutate(Age = as.numeric(Season) - Birthyear) ->
aaron_pujols
aaron_pujols %>%
group_by(Player, Age) %>%
summarize(AB = n(),
HR = sum(Outcome),
.groups = "drop") %>%
mutate(HR_Rate = 100 * HR / AB) -> S
ggplot(S, aes(Age, HR_Rate, color = Player)) +
geom_point() +
geom_smooth(method = "loess",
formula = "y ~ x",
se = FALSE) +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0)) +
ggtitle("Comparing Home Run Rates") +
ylab("HR Rate (Pct)")
find_spacings2 <- function(age, streak_data) {
d <- filter(streak_data, Age == age)
runs <- rle(d$Outcome)
data.frame(Age = age,
Spacing =
runs$lengths[runs$values == 0])
}
find_spacings2(28, filter(aaron_pujols,
Player == "Albert Pujols" ))
ap_spacings <- map_df(21:41, find_spacings2,
filter(aaron_pujols,
Player == "Albert Pujols" )) %>%
mutate(Player = "Albert Pujols")
ha_spacings <- map_df(20:42, find_spacings2,
filter(aaron_pujols,
Player == "Henry Aaron" )) %>%
mutate(Player = "Henry Aaron")
all_spacings <- rbind(ha_spacings,
ap_spacings)
all_spacings %>%
group_by(Player, Age) %>%
summarize(M = mean(Spacing),
V = var(Spacing)) %>%
mutate(Measure = V / M / (M + 1)) -> S1
ggplot(S1, aes(Age, Measure, color = Player)) +
geom_point() +
geom_hline(yintercept = 1) +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0)) +
ggtitle("Comparing Streaky Measures")
ha_values <- filter(all_spacings,
Player == "Henry Aaron")$Spacing
q1 <- quantile(ha_values,
seq(.05, .95, by = .1))
ap_values <- filter(all_spacings,
Player == "Albert Pujols")$Spacing
q2 <- quantile(ap_values,
seq(.05, .95, by = .1))
plot(q1, q2)
abline(a = 0, b = 1)
library(readr)
sc2022 <- read_csv("~/Dropbox/2022 WORK/Statcast2022/ORIGINAL/sc2022.csv")
View(sc2022)
chadwick <- chadwick_player_lu()
chadwick %>%
filter(name_last == "Pujols",
name_first == "Albert") %>%
pull(key_mlbam) -> albert_id
albert_id
sc2022 %>%
filter(batter == albert_id) -> albert
View(albert)
albert %>%
arrange(game_date,
game_pk,
at_bat_number,
pitch_number) %>%
group_by(game_date, game_pk, at_bat_number) %>%
summarize(Event = last(events)) -> S
event_types <- unique(S$Event)
event_types
S_AB <- filter(S, Event %in%
event_types[c(1, 2, 3, 4, 5, 7,
8, 9, 10, 12)])
names(aaron_pujols)
S_AB %>%
mutate(Outcome = ifelse(events == "home_run", 1, 0),
Player = "Albert Pujols",
Season = 2022) %>%
select(Outcome, Player, Season) -> S_AB1
names(S_AB)
S_AB %>%
mutate(Outcome = ifelse(Event == "home_run", 1, 0),
Player = "Albert Pujols",
Season = 2022) %>%
select(Outcome, Player, Season) -> S_AB1
S_AB %>%
mutate(Outcome = ifelse(Event == "home_run", 1, 0),
Player = "Albert Pujols",
Season = 2022) %>%
ungroup() %>%
select(Outcome, Player, Season) -> S_AB1
head(S_AB1)
sum(S_AB1$Outcome)
write_csv(S_AB1, "pujols_2022.csv")
pujols_2022 <-
read_csv("pujols_2022.csv")
aaron_pujols <-
read_csv("aaron_pujols_HR.csv")
names(aaron_pujols)
names(pujols_2022)
aaron_pujols <-
read_csv("aaron_pujols_HR.csv") %>%
select(Outcome, Player, Season)
pujols_2022 <-
read_csv("pujols_2022.csv")
aaron_pujols <- rbind(aaron_pujols,
pujols_2022)
aaron_pujols %>%
group_by(Player) %>%
summarize(AB = n(),
HR = sum(Outcome)) %>%
mutate(HR_Rate = 100 * HR / AB)
aaron_spacings <- find_spacings(filter(aaron_pujols,
Player == "Henry Aaron"))
geometric_plot(aaron_spacings)
pujols_spacings <- find_spacings(filter(aaron_pujols,
Player == "Albert Pujols"))
geometric_plot(pujols_spacings)
find_spacings = function(streak_data, value = 0) {
# input is a data frame
runs <- rle(streak_data$Outcome)
data.frame(Spacing =
runs$lengths[runs$values == value]) %>%
mutate(N = row_number()) %>%
select(N, Spacing)
}
aaron_spacings <- find_spacings(filter(aaron_pujols,
Player == "Henry Aaron"))
geometric_plot(aaron_spacings)
pujols_spacings <- find_spacings(filter(aaron_pujols,
Player == "Albert Pujols"))
geometric_plot(pujols_spacings)
ages <- data.frame(Player = c("Henry Aaron",
"Albert Pujols"),
Birthyear = c(1934, 1980))
inner_join(aaron_pujols, ages, by = "Player") ->
aaron_pujols
aaron_pujols %>%
mutate(Age = as.numeric(Season) - Birthyear) ->
aaron_pujols
aaron_pujols %>%
group_by(Player, Age) %>%
summarize(AB = n(),
HR = sum(Outcome),
.groups = "drop") %>%
mutate(HR_Rate = 100 * HR / AB) -> S
ggplot(S, aes(Age, HR_Rate, color = Player)) +
geom_point() +
geom_smooth(method = "loess",
formula = "y ~ x",
se = FALSE) +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0)) +
ggtitle("Comparing Home Run Rates") +
ylab("HR Rate (Pct)")
find_spacings2 <- function(age, streak_data) {
d <- filter(streak_data, Age == age)
runs <- rle(d$Outcome)
data.frame(Age = age,
Spacing =
runs$lengths[runs$values == 0])
}
find_spacings2(28, filter(aaron_pujols,
Player == "Albert Pujols" ))
ap_spacings <- map_df(21:42, find_spacings2,
filter(aaron_pujols,
Player == "Albert Pujols" )) %>%
mutate(Player = "Albert Pujols")
ha_spacings <- map_df(20:42, find_spacings2,
filter(aaron_pujols,
Player == "Henry Aaron" )) %>%
mutate(Player = "Henry Aaron")
all_spacings <- rbind(ha_spacings,
ap_spacings)
all_spacings %>%
group_by(Player, Age) %>%
summarize(M = mean(Spacing),
V = var(Spacing)) %>%
mutate(Measure = V / M / (M + 1)) -> S1
ggplot(S1, aes(Age, Measure, color = Player)) +
geom_point() +
geom_hline(yintercept = 1) +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0)) +
ggtitle("Comparing Streaky Measures")
aaron_pujols %>%
group_by(Player) %>%
summarize(AB = n(),
HR = sum(Outcome)) %>%
mutate(HR_Rate = 100 * HR / AB)
100 * 755 / 12364
aaron_br <- read_csv("aaron_br.csv")
aaron_br <- read_csv("aaron_br.csv") %>%
mutate(Player = "Henry Aaron")
pujols_br <- read_csv("pujols_br.csv") %>%
mutate(Player = "Albert Pujols")
br <- rbind(aaron_br, pujols_br)
inner_join(br, ages, by = "Player") ->
br
names(br)
ggplot(br, aes(Age,
HR / AB * 100,
color = Player)) +
geom_point() +
geom_smooth(method = "loess",
formula = "y ~ x",
se = FALSE) +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0)) +
ggtitle("Comparing Home Run Rates") +
ylab("HR Rate (Pct)")
ggplot(br, aes(Age,
HR / AB * 100,
color = Player)) +
geom_point() +
geom_smooth(method = "loess",
formula = "y ~ x",
se = FALSE) +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0)) +
ggtitle("Home Run Rates of Aaron and Pujols") +
ylab("HR Rate (Pct)")
geometric_plot(aaron_spacings) +
ggtitle("Geometric Plot of Aaron Spacings")
geometric_plot(aaron_spacings) +
ggtitle("Geometric Plot of Aaron Spacings") +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0))
geometric_plot(aaron_spacings) +
ggtitle("Geometric Plot of Aaron Spacings") +
theme(plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0))
geometric_plot(pujols_spacings) +
ggtitle("Geometric Plot of Pujols Spacings") +
theme(plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0))
br %>%
group_by(Player) %>%
summarize(HR = sum(HR),
AB = sum(AB)) %>%
mutate(HR_Rate = 100 * HR / AB)
ggplot(S1, aes(Age, Measure, color = Player)) +
geom_point() +
geom_hline(yintercept = 1) +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0)) +
ggtitle("Comparing Streaky Measures")
ggplot(S1, aes(Age, Measure, color = Player)) +
geom_point(size = 2) +
geom_hline(yintercept = 1) +
theme(text=element_text(size=18),
plot.title = element_text(colour = "blue",
size = 18,
hjust = 0.5,
vjust = 0.8, angle = 0)) +
ggtitle("Comparing Streaky Measures")
aaron_spacings <- filter(aaron_pujols, Player == "Henry Aaron")
dim(aaron_spacings)
12069 / 12364
geometric_plot
aaron_spacings %>%
mutate(Player = "Henry Aaron") -> aaron_spacings
pujols_spacings %>%
mutate(Player = "Albert Pujols") -> pujols_spacings
spacings <- rbind(aaron_spacings,
pujols_spacings)
names(aaron_spacings)
aaron_spacings <- find_spacings(filter(aaron_pujols,
Player == "Henry Aaron"))
pujols_spacings <- find_spacings(filter(aaron_pujols,
Player == "Albert Pujols"))
aaron_spacings %>%
mutate(Player = "Henry Aaron") -> aaron_spacings
pujols_spacings %>%
mutate(Player = "Albert Pujols") -> pujols_spacings
spacings <- rbind(aaron_spacings,
pujols_spacings)
names(spacings)
spacings %>%
group_by(Player) %>%
summarize(M = mean(Spacing),
V = var(Spacing),
S = V / (M * (M + 1)))
spacings %>%
group_by(Player) %>%
summarize(N= n(),
M = mean(Spacing),
V = var(Spacing),
S = V / (M * (M + 1)))
spacings %>%
group_by(Player) %>%
summarize(N= n(),
M = mean(Spacing),
Var = var(Spacing),
S = Var / (M * (M + 1)))
